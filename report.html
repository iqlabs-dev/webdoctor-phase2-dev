<body>
  <div id="wd-report-shell">
    Loading reportâ€¦
  </div>

  <script type="module">
    async function loadReport() {
      const params = new URLSearchParams(window.location.search);
      const reportId = params.get('report_id');

      if (!reportId) {
        document.getElementById('wd-report-shell').textContent =
          'Missing report ID.';
        return;
      }

      try {
        const resp = await fetch('/.netlify/functions/get-report?report_id=' + encodeURIComponent(reportId));
        if (!resp.ok) {
          document.getElementById('wd-report-shell').textContent =
            'Could not load report.';
          return;
        }

        const html = await resp.text();
        // Replace the whole page with the report HTML
        document.open();
        document.write(html);
        document.close();
      } catch (err) {
        console.error('get-report error', err);
        document.getElementById('wd-report-shell').textContent =
          'Error loading report.';
      }
    }

    loadReport();
  </script>
</body>
